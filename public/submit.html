<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Submit Review — NextPrint</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#67707a;
      --accent:#1161ff;
      --accent-2:#0a6cff;
      --danger:#e04545;
      --radius:12px;
      --glass: rgba(255,255,255,0.6);
      --shadow: 0 8px 30px rgba(18, 22, 30, 0.06);
    }

    /* Reset-ish */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #eef4ff 0%, var(--bg) 100%);
      color:#13202b;
      -webkit-font-smoothing:antialiased;
      padding:28px;
      display:flex;
      align-items:flex-start;
      justify-content:center;
    }

    .wrap{
      width:100%;
      max-width:920px;
      margin:auto;
    }

    header{
      display:flex;
      align-items:center;
      gap:18px;
      margin-bottom:18px;
    }
    header .logo{
      background:var(--card);
      width:56px;height:56px;border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      box-shadow: var(--shadow);
      font-weight:700;color:var(--accent-2);
      font-size:18px;
    }
    header h1{font-size:20px;margin:0}
    header p{margin:2px 0 0;color:var(--muted);font-size:13px}

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:22px;
      overflow:hidden;
    }

    .two-col{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:20px;
    }

    /* Make single-column on small screens */
    @media (max-width:900px){
      .two-col{grid-template-columns:1fr; padding-bottom:8px}
    }

    .form-wrap label{
      display:block;
      font-weight:600;
      font-size:13px;
      margin-bottom:8px;
      color:#273238;
    }

    .field{
      margin-bottom:14px;
    }

    input[type="text"], input[type="file"], textarea, select {
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e2e6ea;
      background:linear-gradient(180deg, #fff, #fbfdff);
      font-size:14px;
      outline: none;
    }
    input:focus, textarea:focus, select:focus{box-shadow:0 6px 18px rgba(13,82,255,0.06);border-color:var(--accent)}

    textarea{min-height:120px;resize:vertical;padding-top:10px}

    .row{
      display:flex;
      gap:12px;
    }
    .row .col{flex:1}

    .small{
      font-size:12px;color:var(--muted);margin-top:6px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border-radius:10px;
      background:linear-gradient(180deg,var(--accent),var(--accent-2));
      color:#fff;
      border:none;
      cursor:pointer;
      font-weight:600;
      box-shadow: 0 6px 18px rgba(10,100,255,0.14);
    }
    .btn:disabled{opacity:0.6;cursor:not-allowed}

    .muted{color:var(--muted);font-size:13px}

    /* Right column preview */
    .preview-card{
      border-radius:12px;
      padding:14px;
      background: linear-gradient(180deg, rgba(10,100,255,0.03), rgba(255,255,255,0.6));
      border:1px solid rgba(12,50,120,0.03);
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
      min-height:200px;
    }
    .thumb{
      height:200px;
      border-radius:10px;
      background:linear-gradient(180deg,#f8fbff,#ffffff);
      border:1px dashed #dfe7f5;
      display:flex;align-items:center;justify-content:center;
      overflow:hidden;
    }
    .thumb img{max-width:100%; max-height:100%; object-fit:contain; display:block}

    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      font-size:13px;
    }

    .rating-stars{
      display:flex;
      gap:6px;
      align-items:center;
    }
    .star{
      font-size:18px;
      color:#cfcfcf;
      user-select:none;
      cursor:pointer;
      transition:transform .12s ease;
    }
    .star.active{color:#ffb400; transform:scale(1.06)}
    .note{font-size:13px;color:var(--muted)}

    .msg{
      margin-top:12px;
      font-size:14px;
    }
    .msg.ok{color:green}
    .msg.err{color:var(--danger)}

    /* small helper for required marker */
    .req{color:var(--danger);margin-left:6px;font-weight:700}

    /* subtle form footer */
    .form-footer{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:8px}
    .spinner{
      width:18px;height:18px;border-radius:50%;
      border:3px solid rgba(255,255,255,0.25);
      border-top-color: rgba(255,255,255,0.9);
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* tiny mobile adjustments */
    @media (max-width:480px){
      .thumb{height:160px}
      .meta{flex-direction:column;align-items:flex-start;gap:6px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">NP</div>
      <div>
        <h1>Submit your Fan Review</h1>
        <p>Share a photo of your jersey and your review. Reviews are published after approval.</p>
      </div>
    </header>

    <div class="card">
      <div class="two-col">
        <!-- LEFT: FORM -->
        <div class="form-wrap">
          <form id="reviewForm" enctype="multipart/form-data" novalidate>
            <div class="field">
              <label for="name">Your name <span class="req">*</span></label>
              <input id="name" name="name" type="text" placeholder="e.g. Saravana Kumar" required />
            </div>

            <div class="row">
              <div class="col field">
                <label for="city">City (optional)</label>
                <input id="city" name="city" type="text" placeholder="Chennai" />
              </div>
              <div class="col field">
                <label for="rating">Rating</label>
                <select id="rating" name="rating" aria-label="Rating">
                  <option value="5">5 - Excellent</option>
                  <option value="4">4 - Very good</option>
                  <option value="3">3 - Good</option>
                  <option value="2">2 - Fair</option>
                  <option value="1">1 - Poor</option>
                </select>
              </div>
            </div>

            <div class="field">
              <label for="text">Review <span class="req">*</span></label>
              <textarea id="text" name="text" rows="5" placeholder="Tell other fans about the jersey..." required></textarea>
              <div class="small">Keep it helpful — 5–3000 characters.</div>
            </div>

            <div class="field">
              <label for="image">Photo (optional)</label>
              <input id="image" name="image" type="file" accept="image/*" />
              <div id="fileHelp" class="small">Max 5MB. JPG, PNG supported.</div>
            </div>

            <div class="form-footer">
              <div class="muted">All reviews are moderated before appearing.</div>
              <div style="display:flex;gap:10px;align-items:center">
                <button type="submit" class="btn" id="submitBtn">
                  <span id="btnText">Submit review</span>
                </button>
              </div>
            </div>

            <div id="msg" class="msg" role="status" aria-live="polite"></div>
          </form>
        </div>

        <!-- RIGHT: PREVIEW / INFO -->
        <aside class="preview-card">
          <div class="thumb" id="thumb">
            <div class="note">No photo selected — preview will appear here.</div>
          </div>

          <div class="meta">
            <div>
              <div style="font-weight:700" id="previewName">Your name</div>
              <div class="note" id="previewCity">City • Rating</div>
            </div>

            <div style="text-align:right">
              <div class="rating-stars" id="starWrap" title="Click stars to set rating">
                <!-- stars injected by JS -->
              </div>
              <div class="small">Click a star to set rating</div>
            </div>
          </div>

          <div class="note">Preview updates live while you type. Image preview shows selected file before you upload.</div>
        </aside>
      </div>
    </div>
  </div>

  <script>
    // Elements
    const form = document.getElementById('reviewForm');
    const nameEl = document.getElementById('name');
    const cityEl = document.getElementById('city');
    const textEl = document.getElementById('text');
    const ratingEl = document.getElementById('rating');
    const imageEl = document.getElementById('image');
    const thumb = document.getElementById('thumb');
    const previewName = document.getElementById('previewName');
    const previewCity = document.getElementById('previewCity');
    const msg = document.getElementById('msg');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const starWrap = document.getElementById('starWrap');

    // Create rating stars (1..5)
    function renderStars(current = parseInt(ratingEl.value || 5)) {
      starWrap.innerHTML = '';
      for(let i=1;i<=5;i++){
        const span = document.createElement('span');
        span.className = 'star' + (i <= current ? ' active' : '');
        span.innerHTML = '★';
        span.tabIndex = 0;
        span.setAttribute('role','button');
        span.setAttribute('aria-label', i + ' star');
        span.dataset.value = i;
        span.addEventListener('click', ()=> {
          ratingEl.value = i;
          renderStars(i);
        });
        span.addEventListener('keydown', (ev)=> {
          if(ev.key === 'Enter' || ev.key === ' ') {
            ev.preventDefault();
            ratingEl.value = i;
            renderStars(i);
          }
        });
        starWrap.appendChild(span);
      }
    }
    renderStars();

    // Live preview binding
    nameEl.addEventListener('input', ()=> previewName.textContent = nameEl.value || 'Your name');
    cityEl.addEventListener('input', ()=> {
      const city = cityEl.value.trim();
      previewCity.textContent = city ? city + ' • Rating ' + ratingEl.value : 'Rating ' + ratingEl.value;
    });
    ratingEl.addEventListener('change', ()=> {
      renderStars(parseInt(ratingEl.value));
      const city = cityEl.value.trim();
      previewCity.textContent = city ? city + ' • Rating ' + ratingEl.value : 'Rating ' + ratingEl.value;
    });

    // File preview (client-side)
    imageEl.addEventListener('change', (e)=>{
      const f = e.target.files && e.target.files[0];
      thumb.innerHTML = '';
      if(!f){
        thumb.innerHTML = '<div class="note">No photo selected — preview will appear here.</div>';
        return;
      }
      if(!f.type.startsWith('image/')) {
        thumb.innerHTML = '<div class="note">Selected file is not an image.</div>';
        return;
      }
      if(f.size > 5 * 1024 * 1024) {
        thumb.innerHTML = '<div class="note">File too large (max 5MB).</div>';
        return;
      }
      const img = document.createElement('img');
      img.alt = 'Selected photo preview';
      const reader = new FileReader();
      reader.onload = function(ev){ img.src = ev.target.result; };
      reader.readAsDataURL(f);
      thumb.appendChild(img);
    });

    // Form submit
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent = '';
      msg.className = 'msg';

      // simple client side checks
      if(!nameEl.value.trim()){
        msg.textContent = 'Please enter your name';
        msg.classList.add('err');
        nameEl.focus();
        return;
      }
      if(!textEl.value.trim()){
        msg.textContent = 'Please write a review';
        msg.classList.add('err');
        textEl.focus();
        return;
      }

      // Prepare
      const fd = new FormData(form);

      // Disable UI
      submitBtn.disabled = true;
      btnText.textContent = 'Uploading...';
      const spinner = document.createElement('span');
      spinner.className = 'spinner';
      submitBtn.prepend(spinner);

      try {
        const resp = await fetch('/api/submit-review', {
          method: 'POST',
          body: fd
        });

        // handle non-json or network gracefully
        if(!resp.ok){
          let txt;
          try { txt = await resp.text(); } catch(_) { txt = resp.statusText || 'Server error'; }
          throw new Error(txt || 'Upload failed');
        }

        const json = await resp.json();
        if(json && json.ok){
          msg.textContent = json.message || 'Review submitted — thanks!';
          msg.classList.add('ok');
          form.reset();
          // reset preview
          previewName.textContent = 'Your name';
          previewCity.textContent = 'Rating ' + ratingEl.value;
          thumb.innerHTML = '<div class="note">No photo selected — preview will appear here.</div>';
          renderStars(parseInt(ratingEl.value));
        } else {
          msg.textContent = (json && json.message) ? json.message : 'Submission failed';
          msg.classList.add('err');
        }
      } catch(err) {
        console.error(err);
        msg.textContent = err?.message || 'Network or server error';
        msg.classList.add('err');
      } finally {
        // restore
        submitBtn.disabled = false;
        btnText.textContent = 'Submit review';
        const spin = submitBtn.querySelector('.spinner');
        if(spin) spin.remove();
      }
    });

    // Accessibility: press Enter on preview name to focus name input
    previewName.addEventListener('click', ()=> nameEl.focus());
  </script>
</body>
</html>
