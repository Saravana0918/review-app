<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Review Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;padding:20px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border:1px solid #ddd}
    img{max-width:120px;height:auto;border-radius:6px}
    .approve{background:#16a34a;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}
    .pw{margin-bottom:12px}
  </style>
</head>
<body>
  <h2>Reviews Admin</h2>
  <div class="pw">
    <label>Admin password: <input id="pw" type="password" /></label>
    <button id="load">Load reviews</button>
  </div>
  <div id="list"></div>

  <script>
  async function load(){
    const pw = document.getElementById('pw').value;
    const resp = await fetch('/api/admin/reviews?admin_password=' + encodeURIComponent(pw));
    const json = await resp.json();
    if(!json.ok) return document.getElementById('list').innerText = 'Auth failed or no reviews';
    const rows = json.reviews;
    if(rows.length === 0) return document.getElementById('list').innerText = 'No submissions yet';
    let html = '<table><thead><tr><th>Preview</th><th>Name</th><th>City</th><th>Rating</th><th>Text</th><th>Approved</th><th>Action</th></tr></thead><tbody>';
    for(const r of rows){
      html += '<tr>';
      html += '<td>' + (r.image ? '<img src="'+r.image+'">' : '') + '</td>';
      html += '<td>' + (r.name||'') + '</td>';
      html += '<td>' + (r.city||'') + '</td>';
      html += '<td>' + (r.rating||'') + '</td>';
      html += '<td>' + (r.text||'') + '</td>';
      html += '<td>' + (r.approved ? 'Yes' : 'No') + '</td>';
      html += '<td>' + (r.approved ? '' : '<button class="approve" data-id="'+r.id+'">Approve</button>') + '</td>';
      html += '</tr>';
    }
    html += '</tbody></table>';
    document.getElementById('list').innerHTML = html;
    document.querySelectorAll('.approve').forEach(b=>{
      b.addEventListener('click', async ()=>{
        const id = b.getAttribute('data-id');
        const resp2 = await fetch('/api/admin/approve/' + id, { method:'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ admin_password: document.getElementById('pw').value }) });
        const j2 = await resp2.json();
        if(j2.ok){ load(); } else { alert('Approve failed'); }
      });
    });
  }
  document.getElementById('load').addEventListener('click', load);
  </script>
</body>
</html>
